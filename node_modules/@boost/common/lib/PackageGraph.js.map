{"version":3,"file":"PackageGraph.js","sources":["../src/PackageGraph.ts"],"sourcesContent":null,"names":["Node","constructor","name","dependents","Set","requirements","PackageGraph","packages","mapped","nodes","Map","addPackages","addPackage","pkg","resetNodes","set","addNode","forEach","resolveList","resolveBatchList","reduce","flatList","batchList","push","resolveTree","mapDependencies","seen","resolve","node","tree","has","get","branch","package","sortByDependedOn","child","add","trunk","root","getRootNodes","size","detectCycle","batches","addBatch","nextBatch","values","filter","dep","length","map","dig","cycle","path","n","join","Error","rootNodes","Object","keys","dependencies","peerDependencies","depName","mapDependency","dependentName","requirementName","requirement","dependent","clear","sort","a","b","diff"],"mappings":"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"}